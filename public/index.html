<!DOCTYPE html>
<html lang="en">
<head>
    <title>HIMA Song Request</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ctp: {
                            base: '#1e1e2e',
                            mantle: '#181825',
                            crust: '#11111b',
                            text: '#cdd6f4',
                            subtext0: '#a6adc8',
                            surface0: '#313244',
                            surface1: '#45475a',
                            blue: '#89b4fa',
                            mauve: '#cba6f7',
                            red: '#f38ba8',
                            green: '#a6e3a1',
                            lavender: '#b4befe'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>

<body class="bg-ctp-base text-ctp-text min-h-screen flex flex-col items-center py-10 px-4 selection:bg-ctp-mauve selection:text-ctp-base">

    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-ctp-mauve mb-2">ðŸŽµ HIMA Jukebox</h1>
        <p class="text-ctp-subtext0">Request your favorite songs to play in the secretariat.</p>
    </div>

    <!-- Request Card -->
    <div class="w-full max-w-md bg-ctp-mantle p-6 rounded-2xl shadow-xl border border-ctp-surface0 mb-8">
        <label class="block text-sm font-semibold text-ctp-lavender mb-2">Enter YouTube Link or Search</label>
        <div class="flex gap-2">
            <input type="text" id="linkInput" 
                class="w-full bg-ctp-surface0 text-ctp-text placeholder-ctp-overlay0 border border-ctp-surface1 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-ctp-blue focus:border-transparent transition-all"
                placeholder="Paste Link or Type Song Title..."
            >
            <button onclick="requestLagu()" 
                class="bg-ctp-blue hover:bg-opacity-80 text-ctp-base font-bold py-3 px-6 rounded-lg transition-transform active:scale-95 shadow-lg shadow-ctp-blue/20">
                Submit
            </button>
        </div>
    </div>

    <!-- Now Playing -->
    <div class="w-full max-w-md mb-8">
        <h3 class="text-sm font-bold text-ctp-green uppercase tracking-wider mb-3">Now Playing</h3>
        <div id="nowPlayingContainer" class="bg-ctp-surface0/50 p-4 rounded-xl border border-ctp-surface1 flex items-center gap-4 animate-pulse">
            <div class="w-12 h-12 bg-ctp-mauve rounded-full flex items-center justify-center text-ctp-base">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2z" />
                </svg>
            </div>
            <div id="nowPlaying" class="text-ctp-text">
                <span class="text-ctp-subtext0 italic">Silence... No songs yet.</span>
            </div>
        </div>
    </div>

    <!-- Queue List -->
    <div class="w-full max-w-md flex-1">
        <h3 class="text-sm font-bold text-ctp-lavender uppercase tracking-wider mb-3">Up Next</h3>
        <div class="bg-ctp-mantle rounded-2xl p-2 shadow-inner border border-ctp-surface0 min-h-[200px]">
            <ul id="queueList" class="space-y-2">
                <!-- Items will be injected here -->
                <li class="text-center text-ctp-surface1 py-8 text-sm">Queue is empty. Be the first!</li>
            </ul>
        </div>
    </div>

    <!-- Footer -->
    <footer class="mt-10 text-ctp-surface1 text-xs">
        &copy; 2025 HIMA Jukebox System
    </footer>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // Get input element
        const inputField = document.getElementById("linkInput");

        // Add event listener for Enter key
        inputField.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault(); 
                requestLagu();
            }
        });

        function requestLagu() {
            const input = document.getElementById('linkInput');
            if (input.value) {
                // Visual feedback button
                const btn = document.querySelector('button');
                const originalText = btn.innerText;
                btn.innerText = "Sent!";
                btn.classList.add('bg-ctp-green', 'text-ctp-base');
                btn.classList.remove('bg-ctp-blue');
                
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.classList.remove('bg-ctp-green', 'text-ctp-base');
                    btn.classList.add('bg-ctp-blue');
                }, 1000);

                socket.emit('request_song', input.value);
                input.value = ''; 
            }
        }

        socket.on('update_queue', (data) => {
            // Update Now Playing
            const npContainer = document.getElementById('nowPlayingContainer');
            if (data.currentSong) {
                npContainer.classList.remove('animate-pulse');
                document.getElementById('nowPlaying').innerHTML = `
                    <div class="font-bold text-lg leading-tight line-clamp-1">${data.currentSong.title}</div>
                    <div class="text-sm text-ctp-subtext0 flex items-center gap-1">
                        <span>ðŸ‘¤ ${data.currentSong.artist}</span>
                    </div>
                `;
            } else {
                npContainer.classList.add('animate-pulse');
                document.getElementById('nowPlaying').innerHTML = `<span class="text-ctp-subtext0 italic">Silence... No songs yet.</span>`;
            }

            // Update List Antrian
            const list = document.getElementById('queueList');
            list.innerHTML = "";

            if (data.playlist.length === 0) {
                list.innerHTML = `<li class="text-center text-ctp-surface1 py-8 text-sm">Queue is empty. Be the first!</li>`;
            } else {
                data.playlist.forEach((song, index) => {
                    const li = document.createElement('li');
                    li.className = "bg-ctp-surface0/40 hover:bg-ctp-surface0 transition-colors p-3 rounded-lg flex items-start gap-3 border border-transparent hover:border-ctp-surface1";
                    li.innerHTML = `
                        <div class="text-ctp-overlay0 font-mono text-sm mt-1">#${index + 1}</div>
                        <div class="overflow-hidden">
                            <div class="font-semibold text-ctp-text truncate">${song.title}</div>
                            <div class="text-xs text-ctp-subtext0 truncate">ðŸ‘¤ ${song.artist}</div>
                        </div>
                    `;
                    list.appendChild(li);
                });
            }
        });
    </script>
</body>
</html>